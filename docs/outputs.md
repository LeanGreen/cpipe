# Outputs

Cpipe produces a number of outputs in different formats:
* A summary report, one for each sample
* A VCF, one for each sample

## Summary Report
Cpipe generates a summary HTML for each analysed sample in a batch. It is of the form sample_name.summary.htm.
 
The report contains three main sections:
* Summary Data
* Coverage Summary
* Gene Summary

### Summary Data

This section contains the following fields:
 
| Field Name | Source |
| --- | --- |
| Batch | sample metadata file |
| Study ID | sample metadata file |
| Sex | sample metadata file |
| Inferred Sex | See detail below.  Displayed in red if this value doesn’t match Sex.|
| Disease Cohort | sample metadata file |
| Hospital/Institution | sample metadata file |
| Ethnicity | sample metadata file |
| Prioritized Genes | sample metadata file |
| Consanguinity Status | sample metadata file (with _ replaced with spaces) |
| Sample type (tumor/normal) | sample metadata file | 
| Sequencing Dates | sample metadata file |
| DNA Collection Dates | sample metadata file |
| Sequencing Machines | sample metadata file |
 
### Inferred Sex Calculation

We use the coverage from chromosomes 1 and 22 as proxy estimates for the autosomal coverage.  
For females we expect the X coverage to be similar to the autosomes coverage (i.e. diploid).  
For males, we expect the X coverage to be less than the autosome coverage.

* The mean coverage on chromosome 1 and chromosome 22 is calculated.
* The mean coverage on chromosome X is calculated.
* The mean coverage on chromosome Y is calculated.

For females we expect the chr Y coverage to be low, i.e. less than 5X, and the chr X coverage to be > 30X.
These figures assume Nextera exome capture with at least 100X coverage overall and this Female inference would need to
be expanded if significantly higher or lower overall coverage is expected from the WES test.
To ensure robustness to overall test coverage, we might consider developing a ratio based metric for inferring Female 
sex (i.e. chr X mean coverage / Chr Y mean coverage > 3 )

* If chrY mean coverage < 5 and chrX mean coverage > 30 then the inferred sex is FEMALE
* If the chr Y mean coverage is > 5X, this could indicate a Male, or it could be a Female with very high overall coverage (such that the chr Y reaches above 5X by chance).  Therefore, to check for a Male, we base the test on the relative mean coverage of chr X with the autosomes.  We expect a ratio of a half for Males (hence the cut-off of 0.7), while Females we expect 1.
* Otherwise, if mean coverage across chrX / mean coverage across chr1, chr22 < 0.7 then the inferred sex is MALE
* Otherwise, the inferred sex is OTHER

We note that in Nextera captures, the chr Y coverage seems to be higher than expected, often achieving similar mean coverage to the autosomes in Males.  It is for this reason that the sex inference for Males does not use the ratio of chrY coverage compared to the autosome.

## Coverage Summary

The coverage summary includes the following fields:

* Mean Coverage Reported by Lab: the mean coverage reported by the sequencing lab
* Observed Mean Coverage: the mean coverage across the capture region
* Observed Median Coverage: the median coverage across the capture region
* Total Reads: the total number of reads generated by the sequencer
* Unmapped Reads: reads that were not mapped to the genome
* Mapped Paired Reads: paired reads that were mapped to the genome
* % Mapped on Target: the proportion of mapped reads that have any part align to any part of the capture region
* % Coverage within 20% of Mean: bases in the capture region with coverage within 20% of the observed mean coverage
* Mean Fragment Size: the average distance between correctly mapped and paired reads
* Perc: the percentage of the gene overlapping the capture region with acceptable coverage
* Median: the median coverage across the gene overlapping the capture region
* % in capture: the proportion of the gene that overlaps the capture region

### Mean Coverage Calculation
* Regions covered by the exome capture region are considered.
* Only mapped reads with a mapping quality of 1 or more are considered.
* All mapped reads that overlap a region are considered
* Mean Coverage = number of reads overlapping each position in each region / total number of positions

## Gene Summary
This section displays data for a list of genes. The list of genes comes from the coverage file, which ultimately comes 
from the disease cohort BED file.

The table has the following fields:
| Field Name | Source |
| --- | --- |
| Gene | The gene name from the coverage file |
| Category | category from cohort.genes.txt |
| Perc > 20x | Percentage of the bases of this gene (in the cohort BED) with coverage greater than 20 |
| Median | The median coverage over this gene (See below definition for gene coverage) |
| OK? | Based on “Perc > 20X”: >95%: Good, >80%: Pass, Otherwise: Fail |